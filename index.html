<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mic Check ‚Äî Can You Hear Me?</title>
    <!-- 
        Mic Check - Browser Microphone Diagnostic Tool
        Copyright (c) 2026 Matt Read
        Licensed under the MIT License
        https://github.com/mread/mic-check
    -->
    <meta name="description" content="Free tool to test your microphone, check browser permissions, and diagnose why your mic isn't working. No data collected, runs entirely in your browser.">
    
    <!-- Open Graph -->
    <meta property="og:title" content="Mic Check ‚Äî Is Your Microphone Working?">
    <meta property="og:description" content="Free browser-based microphone diagnostic tool. Test your mic, check permissions, troubleshoot issues.">
    <meta property="og:type" content="website">
    
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üé§</text></svg>">
    
    <style>
        /* System font stacks - no external requests for privacy */
        
        :root {
            --bg: #f8f9fa;
            --bg-card: #ffffff;
            --bg-muted: #f1f3f4;
            --bg-elevated: #ffffff;
            --text: #202124;
            --text-secondary: #5f6368;
            --text-muted: #9aa0a6;
            --border: #dadce0;
            --accent: #1a73e8;
            --accent-light: #e8f0fe;
            --problem: #d93025;
            --problem-light: #fce8e6;
            --ok: #1e8e3e;
            --success: #1e8e3e;
            --success-light: #e6f4ea;
            --warning: #f9ab00;
            --warning-light: #fef7e0;
            --shadow: 0 1px 2px rgba(0,0,0,0.1);
            --shadow-lg: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
            min-height: 100vh;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 2rem 1.5rem;
        }
        
        /* Header */
        header {
            text-align: center;
            margin-bottom: 3rem;
        }
        
        .logo {
            font-size: 4rem;
            margin-bottom: 0.5rem;
        }
        
        h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }
        
        .tagline {
            color: var(--text-secondary);
            font-size: 1.1rem;
        }
        
        .privacy-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background: var(--bg-muted);
            color: var(--text-secondary);
            padding: 0.5rem 1rem;
            border-radius: 2rem;
            font-size: 0.8rem;
            font-weight: 500;
            margin-top: 1rem;
        }
        
        /* Cards */
        .card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: var(--shadow);
        }
        
        .card-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        .card-icon {
            font-size: 2rem;
        }
        
        .card-title {
            font-size: 1.25rem;
            font-weight: 600;
        }
        
        .card-subtitle {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }
        
        /* Homepage Layout */
        .home-layout {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }
        
        .home-secondary {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.75rem;
        }
        
        @media (max-width: 600px) {
            .home-secondary {
                grid-template-columns: 1fr;
            }
        }
        
        /* Primary Action Card */
        .primary-action {
            background: var(--bg-card);
            border: 2px solid var(--accent);
            border-radius: 16px;
            padding: 2rem;
            text-align: center;
        }
        
        /* Journey Cards */
        .journey-card {
            background: var(--bg-card);
            border: 2px solid var(--border);
            border-radius: 12px;
            padding: 1rem;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: left;
        }
        
        .journey-card:hover {
            border-color: var(--accent);
            box-shadow: var(--shadow-lg);
            transform: translateY(-2px);
        }
        
        .journey-icon {
            font-size: 1.75rem;
            margin-bottom: 0.5rem;
        }
        
        .journey-title {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 0.25rem;
        }
        
        .journey-desc {
            color: var(--text-secondary);
            font-size: 0.8rem;
        }
        
        /* Buttons */
        .btn {
            font-family: inherit;
            font-size: 1rem;
            font-weight: 600;
            padding: 0.875rem 1.5rem;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }
        
        .btn-primary {
            background: var(--accent);
            color: white;
        }
        
        .btn-primary:hover {
            filter: brightness(1.1);
            transform: translateY(-1px);
        }
        
        .btn-secondary {
            background: var(--bg-elevated);
            color: var(--text);
            border: 1px solid var(--border);
        }
        
        .btn-secondary:hover {
            border-color: var(--accent);
        }
        
        .btn-large {
            width: 100%;
            padding: 1.25rem 2rem;
            font-size: 1.1rem;
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }
        
        .btn-group {
            display: flex;
            gap: 0.75rem;
            flex-wrap: wrap;
        }
        
        .btn-small {
            padding: 0.5rem 1rem;
            font-size: 0.9rem;
        }
        
        /* Diagnostic Results Table - stable structure, only status icons change */
        .diagnostic-table {
            width: 100%;
            border-collapse: collapse;
            margin: 0.5rem 0 1rem;
        }
        
        .diagnostic-table thead {
            display: none; /* Hide header row, structure is self-evident */
        }
        
        .diagnostic-table tr {
            border-bottom: 1px solid var(--border-light, #eee);
        }
        
        .diagnostic-table tr:last-child {
            border-bottom: none;
        }
        
        .diagnostic-table td {
            padding: 0.6rem 0.5rem;
            vertical-align: middle;
        }
        
        .diag-col-status, .diag-status {
            width: 2.5rem;
            text-align: right;
            padding-right: 0.25rem;
        }
        
        .diag-icon {
            font-size: 1.1rem;
        }
        
        .diag-name {
            font-weight: 500;
            font-size: 0.9rem;
            color: var(--text-primary);
        }
        
        .diag-detail {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-top: 0.15rem;
        }
        
        /* Section header row within table */
        .diag-section-row td {
            padding-top: 1rem;
            padding-bottom: 0.4rem;
            border-bottom: none;
        }
        
        .diag-section-header {
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--text-muted);
        }
        
        /* Row states - subtle background changes */
        .diagnostic-table tr.pass td {
            background: var(--success-light);
        }
        
        .diagnostic-table tr.fail td {
            background: var(--problem-light);
        }
        
        .diagnostic-table tr.warn td {
            background: var(--warning-light);
        }
        
        .diagnostic-table tr.running td {
            background: var(--accent-light);
        }
        
        /* Fix instructions - shown outside table when needed */
        .diagnostic-fix {
            margin-top: 1rem;
            padding: 0.75rem 1rem;
            background: var(--problem-light);
            border-left: 3px solid var(--problem);
            border-radius: 0 6px 6px 0;
            font-size: 0.85rem;
        }
        
        .diagnostic-fix ol {
            margin: 0.5rem 0 0 1.25rem;
            padding: 0;
        }
        
        .diagnostic-fix li {
            margin: 0.25rem 0;
        }
        
        /* Status Indicators */
        .status-card {
            display: flex;
            align-items: flex-start;
            gap: 1rem;
            padding: 1rem 1.25rem;
            border-radius: 12px;
            margin: 1rem 0;
            background: var(--bg-muted);
        }
        
        .status-card.success {
            background: #e6f4ea;
        }
        
        .status-card.problem, .status-card.warning, .status-card.error {
            background: var(--problem-light);
        }
        
        .status-card.info {
            background: var(--accent-light);
        }
        
        .status-icon {
            font-size: 1.5rem;
            flex-shrink: 0;
        }
        
        .status-text {
            flex: 1;
        }
        
        .status-title {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }
        
        .status-detail {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }
        
        /* Visualizer */
        .visualizer-container {
            background: var(--bg-elevated);
            border-radius: 12px;
            padding: 1.5rem;
            margin: 1rem 0;
        }
        
        .level-bar-container {
            height: 32px;
            background: linear-gradient(90deg, 
                #1a3d1a 0%, #1a3d1a 60%,
                #3d3d1a 60%, #3d3d1a 85%,
                #3d1a1a 85%, #3d1a1a 100%
            );
            border-radius: 4px;
            overflow: hidden;
            position: relative;
            border: 1px solid #333;
        }
        
        .level-bar {
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            width: 100%;
            background: linear-gradient(90deg, 
                #22c55e 0%, #22c55e 60%,
                #eab308 60%, #eab308 85%,
                #ef4444 85%, #ef4444 100%
            );
            border-radius: 3px;
            transition: clip-path 0.03s ease;
            clip-path: inset(0 100% 0 0);
        }
        
        .level-text {
            position: absolute;
            right: 1rem;
            top: 50%;
            transform: translateY(-50%);
            font-family: ui-monospace, 'SF Mono', SFMono-Regular, Menlo, Monaco, Consolas, monospace;
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text);
        }
        
        /* Device List */
        .device-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.75rem 1rem;
            background: var(--bg-elevated);
            border-radius: 8px;
            margin: 0.25rem 0;
            font-size: 0.9rem;
        }
        
        .device-item.active {
            background: var(--success-light);
            border: 1px solid var(--success);
        }
        
        /* Info Sections */
        .info-box {
            background: var(--bg-elevated);
            border-radius: 12px;
            padding: 1rem 1.25rem;
            margin: 1rem 0;
        }
        
        .info-box h4 {
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .info-box p, .info-box ul {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }
        
        .info-box ul {
            margin-left: 1.25rem;
        }
        
        .info-box li {
            margin: 0.25rem 0;
        }
        
        /* Back Link */
        .back-link {
            display: inline-block;
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 0.9rem;
            margin-bottom: 1rem;
            padding: 0.25rem 0;
        }
        
        .back-link:hover {
            color: var(--accent);
        }
        
        /* Privacy Section */
        .privacy-section {
            background: var(--bg-muted);
            border-radius: 12px;
            padding: 1rem 1.25rem;
            margin: 1.5rem 0;
            font-size: 0.85rem;
            color: var(--text-secondary);
        }
        
        .privacy-section p {
            margin: 0;
            line-height: 1.7;
        }
        
        /* Screens */
        .screen {
            display: none;
        }
        
        .screen.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Toggle Switch */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 28px;
            flex-shrink: 0;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: 0.3s;
            border-radius: 28px;
        }
        
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: 0.3s;
            border-radius: 50%;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .toggle-switch input:checked + .toggle-slider {
            background-color: var(--accent);
        }
        
        .toggle-switch input:checked + .toggle-slider:before {
            transform: translateX(22px);
        }
        
        /* Playback Feature Styles */
        .playback-section {
            padding: 1rem;
            background: var(--bg-elevated);
            border-radius: 12px;
            border: 1px solid var(--border);
        }
        
        .countdown-display {
            font-size: 4rem;
            font-weight: bold;
            color: var(--accent);
            animation: countdownPulse 1s ease-in-out infinite;
        }
        
        @keyframes countdownPulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.8; }
        }
        
        .recording-indicator {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--problem);
            font-weight: 600;
            font-size: 1.1rem;
        }
        
        .recording-dot {
            width: 12px;
            height: 12px;
            background: var(--problem);
            border-radius: 50%;
            animation: recordingPulse 1s ease-in-out infinite;
        }
        
        @keyframes recordingPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }
        
        /* Collapsible sections */
        .collapsible-section {
            border: 1px solid var(--border);
            border-radius: 8px;
            margin-top: 0.5rem;
            overflow: hidden;
        }
        
        .collapsible-header {
            padding: 0.75rem 1rem;
            background: var(--bg-muted);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-weight: 500;
            font-size: 0.9rem;
        }
        
        .collapsible-header:hover {
            background: var(--border);
        }
        
        .collapsible-content {
            padding: 1rem;
            display: none;
        }
        
        .collapsible-section.open .collapsible-content {
            display: block;
        }
        
        .collapsible-arrow {
            transition: transform 0.2s;
        }
        
        .collapsible-section.open .collapsible-arrow {
            transform: rotate(180deg);
        }
        
        /* Table */
        .info-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }
        
        .info-table th, .info-table td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }
        
        .info-table th {
            font-weight: 600;
            background: var(--bg-elevated);
        }
        
        /* Footer */
        footer {
            text-align: center;
            padding: 2rem;
            color: var(--text-muted);
            font-size: 0.85rem;
        }
        
        footer a {
            color: var(--accent);
            text-decoration: none;
        }
        
        /* Responsive */
        @media (max-width: 600px) {
            h1 {
                font-size: 1.75rem;
            }
            
            .container {
                padding: 1rem;
            }
            
            .btn-group {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">üé§</div>
            <h1>Mic Check</h1>
            <p class="tagline">Can you hear me?</p>
            <div class="privacy-badge">
                üîí 100% Private ‚Äî No data leaves your browser
            </div>
        </header>

        <!-- Screen 1: Home -->
        <div id="screen-home" class="screen active">
            <div class="home-layout">
                <!-- Primary: Test Your Microphone -->
                <div class="primary-action">
                    <div style="font-size: 3rem; margin-bottom: 0.5rem;">üé§</div>
                    <h2 style="font-size: 1.5rem; margin-bottom: 0.5rem;">Test Your Microphone</h2>
                    <p style="color: var(--text-secondary); margin-bottom: 1.5rem;">
                        Check if it's working, fix it if it's not
                    </p>
                    <button id="btn-start-test" class="btn btn-primary btn-large">
                        Start Test
                    </button>
                </div>
                
                <!-- Secondary Options -->
                <div class="home-secondary">
                    <div class="journey-card" data-journey="level-check" role="button" tabindex="0">
                        <div class="journey-icon">üìä</div>
                        <div class="journey-title">Level Check</div>
                        <div class="journey-desc">Am I loud enough?</div>
                    </div>
                    
                    <div class="journey-card" data-journey="privacy" role="button" tabindex="0">
                        <div class="journey-icon">üîê</div>
                        <div class="journey-title">Privacy Check</div>
                        <div class="journey-desc">Is my browser listening?</div>
                    </div>
                </div>
            </div>
            
            <div class="privacy-section">
                <p>
                    üîí <strong>100% Private:</strong> No audio recorded. No data sent. No cookies.
                </p>
            </div>
        </div>

        <!-- Screen 2: Microphone Test (Unified Test + Troubleshoot) -->
        <div id="screen-mic-test" class="screen">
            <a href="#" class="back-link" onclick="window.MicCheck.stopTest(); window.MicCheck.showScreen('screen-home'); return false;">‚Üê Back</a>
            
            <div class="card">
                <div class="card-header">
                    <span class="card-icon">üé§</span>
                    <div>
                        <div class="card-title">Microphone Test</div>
                        <div class="card-subtitle" id="test-subtitle">Checking your microphone...</div>
                    </div>
                </div>
                
                <!-- Device Selector (shown after permission) - INPUT/CONTROL area -->
                <div id="device-selector" style="display: none; margin-bottom: 1.5rem; padding-bottom: 1rem; border-bottom: 1px solid var(--border);">
                    <label for="device-select" style="display: block; margin-bottom: 0.5rem; font-weight: 600; font-size: 0.9rem;">Test this microphone:</label>
                    <select id="device-select" style="width: 100%; padding: 0.5rem; border: 1px solid var(--border); border-radius: 6px; font-size: 0.9rem; background: white;">
                    </select>
                </div>
                
                <!-- Diagnostic Results Table - OUTPUT area, stable structure -->
                <!-- Reading order: Test ‚Üí Result (like "Browser Support: ‚úì") -->
                <table id="diagnostic-table" class="diagnostic-table">
                    <thead>
                        <tr>
                            <th class="diag-col-test">Test</th>
                            <th class="diag-col-status">Result</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr id="diag-row-browser-support">
                            <td class="diag-test">
                                <div class="diag-name">Browser Support</div>
                                <div class="diag-detail"></div>
                            </td>
                            <td class="diag-status"><span class="diag-icon">‚è∏Ô∏è</span></td>
                        </tr>
                        <tr id="diag-row-permission-state">
                            <td class="diag-test">
                                <div class="diag-name">Permission Status</div>
                                <div class="diag-detail"></div>
                            </td>
                            <td class="diag-status"><span class="diag-icon">‚è∏Ô∏è</span></td>
                        </tr>
                        <tr id="diag-row-device-enumeration">
                            <td class="diag-test">
                                <div class="diag-name">Microphone Detection</div>
                                <div class="diag-detail"></div>
                            </td>
                            <td class="diag-status"><span class="diag-icon">‚è∏Ô∏è</span></td>
                        </tr>
                        <tr class="diag-section-row">
                            <td colspan="2" class="diag-section-header">Selected Microphone</td>
                        </tr>
                        <tr id="diag-row-stream-acquisition">
                            <td class="diag-test">
                                <div class="diag-name">Microphone Access</div>
                                <div class="diag-detail"></div>
                            </td>
                            <td class="diag-status"><span class="diag-icon">‚è∏Ô∏è</span></td>
                        </tr>
                        <tr id="diag-row-signal-detection">
                            <td class="diag-test">
                                <div class="diag-name">Audio Signal</div>
                                <div class="diag-detail"></div>
                            </td>
                            <td class="diag-status"><span class="diag-icon">‚è∏Ô∏è</span></td>
                        </tr>
                    </tbody>
                </table>
                
                <!-- Fix instructions (shown when a test fails) -->
                <div id="diagnostic-fix" class="diagnostic-fix" style="display: none;">
                </div>
                
                <!-- Visualizer Section (shown when working) -->
                <div id="visualizer-section" style="display: none;">
                    <p style="margin-bottom: 0.75rem; color: var(--text-secondary);">
                        Speak or make a sound:
                    </p>
                    
                    <!-- Spectrogram Canvas -->
                    <div class="spectrogram-container" style="margin-bottom: 1rem; display: flex; gap: 0.5rem;">
                        <div style="display: flex; flex-direction: column; justify-content: space-between; font-size: 0.65rem; color: var(--text-muted); padding: 2px 0;">
                            <span>High</span>
                            <span>Low</span>
                        </div>
                        <div style="flex: 1;">
                            <canvas id="spectrogram-canvas" width="500" height="100" style="width: 100%; height: 100px; border-radius: 4px; background: #0a0a0a;"></canvas>
                            <div style="text-align: center; font-size: 0.65rem; color: var(--text-muted); margin-top: 0.25rem;">
                                ‚Üê time (scrolls left)
                            </div>
                        </div>
                    </div>
                    
                    <!-- Level Meter -->
                    <div class="visualizer-container">
                        <div class="level-bar-container">
                            <div id="level-bar" class="level-bar"></div>
                            <span id="level-text" class="level-text">0%</span>
                        </div>
                    </div>
                    
                    <!-- Playback Feature -->
                    <div id="playback-container" style="display: none; margin-top: 1.5rem;">
                        <!-- Playback record prompt -->
                        <div id="playback-record-prompt" class="playback-section">
                            <p style="color: var(--text-secondary); margin-bottom: 0.75rem; font-size: 0.9rem;">
                                Hear what you sound like to others
                            </p>
                            <button id="btn-start-playback-record" class="btn btn-secondary" style="width: 100%;">
                                üîä Record & Play Back (5 sec)
                            </button>
                            <p style="color: var(--text-muted); font-size: 0.75rem; margin-top: 0.5rem;">
                                üîí Recording stays in your browser and is deleted when you leave
                            </p>
                        </div>
                        
                        <!-- Countdown state -->
                        <div id="playback-countdown" class="playback-section" style="display: none; text-align: center;">
                            <p style="color: var(--text-secondary); margin-bottom: 0.5rem;">Get ready to speak...</p>
                            <div id="countdown-number" class="countdown-display">3</div>
                        </div>
                        
                        <!-- Recording state -->
                        <div id="playback-recording" class="playback-section" style="display: none; text-align: center;">
                            <div class="recording-indicator">
                                <span class="recording-dot"></span>
                                <span>Recording...</span>
                            </div>
                            <div id="recording-timer" style="font-size: 1.5rem; font-weight: bold; margin: 0.5rem 0;">5</div>
                            <p style="color: var(--text-secondary); font-size: 0.85rem;">Speak now!</p>
                        </div>
                        
                        <!-- Ready to play state -->
                        <div id="playback-ready" class="playback-section" style="display: none;">
                            <div id="playback-warning" class="status-card warning" style="display: none; margin-bottom: 1rem;">
                                <span class="status-icon">üîá</span>
                                <div class="status-text">
                                    <div class="status-title">We didn't hear much</div>
                                    <div class="status-detail">
                                        Your mic may be too quiet. 
                                        <a href="#" id="link-playback-level-check" style="color: var(--accent);">Run a Level Check</a> to diagnose.
                                    </div>
                                </div>
                            </div>
                            <div class="btn-group" style="justify-content: center;">
                                <button id="btn-play-recording" class="btn btn-primary">
                                    ‚ñ∂Ô∏è Play Recording
                                </button>
                                <button id="btn-record-again" class="btn btn-secondary">
                                    üîÑ Record Again
                                </button>
                            </div>
                        </div>
                        
                        <!-- Playing state -->
                        <div id="playback-playing" class="playback-section" style="display: none; text-align: center;">
                            <div style="font-size: 1.25rem; margin-bottom: 0.5rem;">üîä Playing...</div>
                            <button id="btn-stop-playback" class="btn btn-secondary btn-small">
                                ‚èπÔ∏è Stop
                            </button>
                        </div>
                        
                        <!-- Hidden audio element -->
                        <audio id="playback-audio" style="display: none;"></audio>
                    </div>
                    
                    <button id="btn-stop-test" class="btn btn-secondary" style="margin-top: 1rem; width: 100%;">
                        ‚èπÔ∏è Stop Test
                    </button>
                </div>
                
                <!-- Action Buttons -->
                <div id="test-actions" style="margin-top: 1rem;">
                    <button id="btn-grant-permission" class="btn btn-primary btn-large" style="display: none;">
                        üé§ Grant Microphone Access
                    </button>
                    <button id="btn-retry-test" class="btn btn-secondary btn-large" style="display: none;">
                        üîÑ Try Again
                    </button>
                </div>
            </div>
            
            <!-- Detected Devices (shown after permission) -->
            <div id="detected-devices" class="card" style="display: none;">
                <div class="card-header">
                    <span class="card-icon">üé§</span>
                    <div>
                        <div class="card-title">Detected Microphones</div>
                        <div class="card-subtitle" id="device-count">Loading...</div>
                    </div>
                </div>
                <div id="device-list">
                    <!-- Populated by JavaScript -->
                </div>
            </div>
        </div>

        <!-- Screen 3: Level Check -->
        <div id="screen-level-check" class="screen">
            <a href="#" class="back-link" onclick="window.MicCheck.showScreen('screen-home'); return false;">‚Üê Back</a>
            
            <div class="card">
                <div class="card-header">
                    <span class="card-icon">üìä</span>
                    <div>
                        <div class="card-title">Microphone Level Check</div>
                        <div class="card-subtitle">Are you loud enough to be heard clearly?</div>
                    </div>
                </div>
                
                <div id="level-check-intro">
                    <p style="color: var(--text-secondary); margin-bottom: 1rem;">
                        <strong>Are people saying you're too quiet in calls?</strong> This test diagnoses common issues 
                        like stereo misconfiguration, insufficient signal, and background noise.
                    </p>
                    
                    <details style="margin-bottom: 1.5rem; font-size: 0.9rem;">
                        <summary style="cursor: pointer; color: var(--accent); font-weight: 500;">‚ÑπÔ∏è What this test does</summary>
                        <div style="margin-top: 0.75rem; padding: 1rem; background: var(--bg-muted); border-radius: 8px;">
                            <p style="margin-bottom: 0.75rem;"><strong>We check if your mic provides enough signal</strong> for browser apps to work with. 
                            Most apps (Google Meet, Zoom web, Discord) use Auto Gain Control (AGC) which automatically adjusts your volume.</p>
                            
                            <p style="margin-bottom: 0.75rem;"><strong>Common issues we detect:</strong></p>
                            <ul style="margin: 0 0 0.75rem 1.25rem; color: var(--text-secondary);">
                                <li><strong>Stereo misconfiguration</strong> ‚Äî A mono mic set as stereo causes 50% volume loss</li>
                                <li><strong>Signal too weak</strong> ‚Äî Even AGC can't compensate if gain is too low</li>
                                <li><strong>Background noise</strong> ‚Äî Makes it hard for others to hear you clearly</li>
                            </ul>
                            
                            <p style="margin-top: 0.75rem; padding-top: 0.75rem; border-top: 1px solid var(--border); font-size: 0.85rem; color: var(--text-muted);">
                                <strong>Technical note:</strong> We measure LUFS per ITU-R BS.1770-4 ‚Äî the same standard used by Spotify, YouTube, and broadcast tools.
                            </p>
                        </div>
                    </details>
                    
                    <div style="margin-bottom: 1.5rem;">
                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Microphone</label>
                        <select id="quality-device-select" style="width: 100%; padding: 0.5rem; border: 1px solid var(--border); border-radius: 6px; font-size: 0.9rem; background: white;">
                            <option value="">Select microphone...</option>
                        </select>
                        <button id="btn-refresh-devices" style="margin-top: 0.5rem; padding: 0.4rem 0.8rem; font-size: 0.8rem; border: 1px solid var(--border); border-radius: 4px; background: var(--bg-muted); cursor: pointer;">
                            Refresh
                        </button>
                    </div>
                    
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; padding: 1rem; background: var(--bg-muted); border-radius: 8px;">
                        <div>
                            <strong>Audio Processing</strong>
                            <div id="agc-description" style="font-size: 0.85rem; color: var(--text-secondary);">
                                On = AGC, noise suppression, echo cancellation
                            </div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="agc-toggle" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    
                    <button id="btn-quality-start" class="btn btn-primary btn-large">
                        Start Level Check
                    </button>
                </div>
                
                <!-- Level Check Steps (populated by JS) -->
                <div id="level-check-steps" style="display: none;">
                    <!-- Step content populated by JavaScript -->
                </div>
                
                <div id="level-check-results" style="display: none;">
                    <!-- Results populated by JavaScript -->
                </div>
            </div>
        </div>

        <!-- Screen 4: Privacy Check -->
        <div id="screen-privacy" class="screen">
            <a href="#" class="back-link" onclick="window.MicCheck.showScreen('screen-home'); return false;">‚Üê Back</a>
            
            <div class="card">
                <div class="card-header">
                    <span class="card-icon">üîê</span>
                    <div>
                        <div class="card-title">Browser Microphone Privacy Check</div>
                        <div class="card-subtitle">Understanding what your browser exposes</div>
                    </div>
                </div>
                
                <div id="privacy-content">
                    <div id="privacy-permission-status"></div>
                    
                    <button id="btn-privacy-check" class="btn btn-secondary" style="display: none;">
                        üîÑ Re-check
                    </button>
                    
                    <div id="privacy-results" style="display: none;">
                        <!-- Populated by JS -->
                    </div>
                </div>
                
                <details style="margin-top: 1.5rem;">
                    <summary style="cursor: pointer; font-weight: 500;">üîÑ How to reset microphone permissions</summary>
                    <div id="reset-instructions" style="margin-top: 0.75rem; padding: 1rem; background: var(--bg-muted); border-radius: 8px;">
                        <!-- Populated based on browser -->
                    </div>
                </details>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <span class="card-icon">üí°</span>
                    <div>
                        <div class="card-title">Good to know</div>
                    </div>
                </div>
                
                <ul style="margin: 0; padding-left: 1.25rem; color: var(--text-secondary); line-height: 1.8;">
                    <li><strong>Permission ‚â† listening.</strong> Granting permission lets a site <em>request</em> your mic ‚Äî it doesn't mean it's recording.</li>
                    <li><strong>Browsers show when mic is active.</strong> Look for a red dot or microphone icon in your tab/address bar.</li>
                    <li><strong>Permissions are per-site.</strong> Each website has its own permission setting.</li>
                    <li><strong>Closing the tab stops access.</strong> No website can listen when you're not on it.</li>
                </ul>
            </div>
        </div>

        <footer>
            <p>Mic Check ‚Äî A free, open-source tool</p>
            <p>No data is collected. Everything runs in your browser.</p>
            <p style="margin-top: 0.5rem;">
                <a href="https://github.com/mread/mic-check" target="_blank" rel="noopener noreferrer">GitHub</a>
                ¬∑ 
                <a href="https://github.com/mread/mic-check/blob/main/LICENSE" target="_blank" rel="noopener noreferrer">MIT License</a>
            </p>
        </footer>
    </div>

    <script type="module" src="js/app.js"></script>
</body>
</html>
